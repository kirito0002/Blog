# 执行上下文、调用栈、变量对象

# JS中的运行环境主要包括三种：全局环境，函数环境，eval环境

+ ## 执行上下文

  + **函数每调用一次**，**就会创建一个新的执行上下文**
  + **函数执行结束，相应的执行上下文销毁**

+ ## 执行上下文栈

  + **执行上下文栈按照函数的调用顺序来管理执行上下文**
  + **栈底永远是全局上下文，栈顶是当前正在执行的函数**

+ ## 调用栈

  ![1551963475897](https://i.imgur.com/aQIREKN.png)

+ ## return语句的作用

  + **返回值**
  + **终止函数的执行**

![1551963646277](https://i.imgur.com/rFFiiYz.png)

+ ## 执行上下文的生命周期

  + **创建阶段**
    + **创建变量对象**
    + **确定作用域链**
    + **确定this的指向**
  + **执行阶段**
    + **变量赋值**
    + **函数引用**
    + **执行代码**

+ ## 变量对象

  ![1551964075254](https://i.imgur.com/kF897hA.png)

+ ## **全局上下文的变量对象**

  + **变量对象就是window对象**

  + **不会变成活动对象**

  + **在页面关闭前一直存在**

    ![1551966774821](https://i.imgur.com/XpniOQ7.png)

+ ## 预编译(预解析)

  ### 预编译的任务: 声明提升(下面)

  + **在执行每一段代码(函数)之前，都会有一个“预编译”**

  + **javascript代码的整个执行过程，分为两个阶段，代码编译与代码执行阶段**
    + **编译阶段由编译器完成，将代码翻译成可执行代码，这个阶段作用域规则会确定**
    + **执行阶段由引擎完成，主要任务是执行可执行代码，执行上下文在这个阶段创建**

![1551964857342](https://i.imgur.com/8NQwDJe.png)

+ ## 声明提升

  **JavaScript引擎把所有的变量声明和函数声明提升到当前作用域的最前面**

  **规则:**

  1. **函数声明整体提前(注意：函数表达式 var fn = function(){})**
  2. **变量声明提前，赋值留在原地**
  3. **函数会首先被提升，然后才是变量  （注意：重复的var声明会被忽略，重复的函数声明可以覆盖前面的）**

![1551966010574](https://i.imgur.com/fPMM0ej.png)

+ ## 活动对象

  ### 执行阶段变量对象会变成活动对象

  ![1551966124431](https://i.imgur.com/a86OBaV.png)

![1551966145133](https://i.imgur.com/wzl0Kwc.png)